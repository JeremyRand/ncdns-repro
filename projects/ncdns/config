#version: 0.0.9
# Using latest master branch because we need the stream isolation and
# disable_namecoin_tlsa features.  Once they're in a tagged release, we'll go
# back to using a version number here.
version: '[% c("abbrev") %]'
git_url: https://github.com/namecoin/ncdns.git
# Using latest master branch because we need the stream isolation and
# disable_namecoin_tlsa features.  Once they're in a tagged release, we'll go
# back to using a hash that corresponds to a tag here.
git_hash: '1e2eea58c79686eea47de873580bcd907ca67d80'
filename: '[% project %]-[% c("version") %]-[% c("var/osname") %]-[% c("var/build_id") %].tar.gz'

var:
  container:
    use_container: 1
  go_lib_deps:
    - gogroupcache
    - godegoutils
    - godexlogconfig
    - goncbtcjsontypes
    - gobtcjson
    - gopretty
    - godns
    - gomadns
    - goeasyconfig
    - goservice
    - goxnet
  go_lib_install:
    - github.com/namecoin/ncdns
    - github.com/namecoin/ncdns/backend
    - github.com/namecoin/ncdns/namecoin
    - github.com/namecoin/ncdns/ncdomain
    - github.com/namecoin/ncdns/ncdt
    - github.com/namecoin/ncdns/rrtourl
    - github.com/namecoin/ncdns/server
    - github.com/namecoin/ncdns/testutil
    - github.com/namecoin/ncdns/tlshook
    - github.com/namecoin/ncdns/util
  go_lib_no_output: 1
  enable_namecoin_tlsa: 1
  os_go_lib_deps: []
  optional_go_lib_deps:
    - gotlsrestrictnss
    - gox509signaturesplice
  optional_go_lib_install:
    - github.com/namecoin/ncdns/certdehydrate
    - github.com/namecoin/ncdns/certinject
    - github.com/namecoin/ncdns/generate_nmc_cert
    - github.com/namecoin/ncdns/ncdumpzone
    - github.com/namecoin/ncdns/ncdumpzone/ncdumpzone
    - github.com/namecoin/ncdns/tlsoverridefirefox
    - github.com/namecoin/ncdns/tlsoverridefirefoxsync
    - github.com/namecoin/ncdns/tlsrestrictchromium
    - github.com/namecoin/ncdns/tlsrestrict_chromium_tool

targets:
  linux:
    var:
      cgo: 1
  linux-i686:
    var:
      arch_deps:
        - libcap-dev:i386
  linux-x86_64:
    var:
      arch_deps:
        - libcap-dev
  osx-x86_64:
    var:
      cgo: 0
  windows:
    var:
      os_go_lib_deps:
        - goxsys
      cgo: 0
  disable_namecoin_tlsa:
    var:
      enable_namecoin_tlsa: 0
      optional_go_lib_deps: []
      optional_go_lib_install: []

input_files:
  - project: container-image
  - name: go
    project: go
  - name: '[% c("var/compiler") %]'
    project: '[% c("var/compiler") %]'
    enable: '[% c("var/cgo") %]'
  - name: binutils
    project: binutils
    enable: '[% c("var/linux") && c("var/cgo") %]'
  - name: goxlog
    project: goxlog
  - name: godexlogconfig
    project: godexlogconfig
  - name: goeasyconfig
    project: goeasyconfig
  - name: goservice
    project: goservice
  - name: gogroupcache
    project: gogroupcache
  - name: goncbtcjsontypes
    project: goncbtcjsontypes
  - name: gobtcjson
    project: gobtcjson
  - name: godns
    project: godns
  - name: gotlsrestrictnss
    project: gotlsrestrictnss
    enable: '[% c("var/enable_namecoin_tlsa") %]'
  - name: gox509signaturesplice
    project: gox509signaturesplice
    enable: '[% c("var/enable_namecoin_tlsa") %]'
  - name: gomadns
    project: gomadns
  - name: gopretty
    project: gopretty
  - name: godegoutils
    project: godegoutils
  - name: goxnet
    project: goxnet
  - name: goxsys
    project: goxsys
    enable: '[% c("var/windows") %]'
